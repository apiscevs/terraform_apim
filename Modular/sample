        public async Task AdjustContainersAsync(
            List<ContainerDefinition> containers,
            bool bumpDbSharedIfNeeded = false)
        {
            // 1) Read current DB-level throughput
            int currentDbRu = 0;
            try
            {
                ThroughputResponse dbRUResponse = await _database.ReadThroughputAsync();
                // ThroughputResponse.Resource has .Throughput and .AutoscaleMaxThroughput
                currentDbRu = dbRUResponse.Resource.AutoscaleMaxThroughput
                              ?? dbRUResponse.Resource.Throughput
                              ?? 0;
            }
            catch (CosmosException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
            {
                // No dedicated DB throughput → purely shared
                currentDbRu = 0;
            }

            Console.WriteLine($"DB shared RU/s = {currentDbRu}");

            // 2) Compute total requested
            int totalRequested = containers.Sum(c => c.AutoscaleMaxRu);
            Console.WriteLine($"Total requested autoscale RU/s = {totalRequested}");

            // 3) Optionally bump DB shared throughput
            if (bumpDbSharedIfNeeded && totalRequested > currentDbRu)
            {
                Console.WriteLine($"→ Updating DB shared throughput to {totalRequested} RU/s");
                var newDbProps = ThroughputProperties.CreateManualThroughput(totalRequested);
                await _database.ReplaceThroughputAsync(newDbProps);
            }

            // 4) For each container: read & adjust
            foreach (var def in containers)
            {
                Container container = _database.GetContainer(def.Name);

                // Read its current throughput (falls back to 0 if shared-only)
                int curr = 0;
                try
                {
                    ThroughputResponse ctRUResponse = await container.ReadThroughputAsync();
                    curr = ctRUResponse.Resource.AutoscaleMaxThroughput
                           ?? ctRUResponse.Resource.Throughput
                           ?? 0;
                }
                catch (CosmosException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
                {
                    // No dedicated container throughput → inherited from DB
                    curr = 0;
                }

                Console.WriteLine($"- Container '{def.Name}' current RU/s = {curr}");

                if (curr < def.AutoscaleMaxRu)
                {
                    Console.WriteLine(
                        $"  → Scaling '{def.Name}' to autoscale max {def.AutoscaleMaxRu}"
                    );
                    var autoscaleProps =
                        ThroughputProperties.CreateAutoscaleThroughput(def.AutoscaleMaxRu);
                    await container.ReplaceThroughputAsync(autoscaleProps);
                }
                else
                {
                    Console.WriteLine($"  → No change needed for '{def.Name}'");
                }
            }
        }