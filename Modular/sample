import org.apache.jmeter.engine.StandardJMeterEngine

// 1) grab the JMeter engine
StandardJMeterEngine engine = ctx.getEngine()

// 2) find the ThreadGroup instance whose name matches your Main TG
def mainTG = engine.getThreadGroups()
                   .find { it.getName() == 'Main TG' }

if (mainTG == null) {
    log.warn("▶ Monitor: could not find a Thread Group named 'Main TG'")
    return
}

// 3) ask the underlying java.lang.ThreadGroup how many live threads it has
int active = mainTG.threadGroup.activeCount()
log.info("▶ Monitor: 'Main TG' active threads = ${active}")

// 4) if there are none, stop the entire test
if (active == 0) {
    log.info("▶ Monitor: no more Main TG threads – stopping test")
    engine.stopTest(true)
}
