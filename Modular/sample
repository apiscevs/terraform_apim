import org.apache.jmeter.threads.JMeterContextService

// 1) Get total active threads in the entire test
int active = JMeterContextService.getNumberOfThreads()

log.info("▶ Monitor: active threads = " + active)

// 2) When only this Monitor thread remains (active ≤ 1), stop the whole test
if (active <= 1) {
    log.info("▶ Monitor: no more worker threads – stopping test")
    ctx.getEngine().stopTest(true)
}
