def now = System.currentTimeMillis()
def lastLogin = vars.get("lastLoginTime")?.toLong() ?: 0
def refreshIntervalMs = 15 * 60 * 1000  // 15 minutes

if ((now - lastLogin) >= refreshIntervalMs) {
    vars.put("needsLogin", "true")
    vars.put("lastLoginTime", now.toString())
    log.info("Thread ${ctx.getThreadNum()} â†’ token refresh triggered")
} else {
    vars.put("needsLogin", "false")
}