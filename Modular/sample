import org.apache.jmeter.threads.JMeterContextService
import org.apache.jmeter.engine.StandardJMeterEngine

def groupNameToWatch = "Main TG"

for (tg in JMeterContextService.getThreadGroups()) {
    if (tg.name == groupNameToWatch) {
        def active = tg.numberOfThreads
        log.info("Monitor TG: Found '$groupNameToWatch' with $active active threads.")
        if (active > 0) {
            return  // exit early, don't stop test yet
        } else {
            log.info("Monitor TG: No active threads in '$groupNameToWatch'. Stopping test.")
            StandardJMeterEngine.stopTest(true)
            return
        }
    }
}

log.warn("Monitor TG: Thread group '$groupNameToWatch' not found.")
