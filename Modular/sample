<policies>
  <inbound>
    <base />
    <!-- normal policies (JWT, rate-limit, etc.) -->

    <choose>
      <!-- MOCK path -->
      <when condition='@((context.Request.Headers.GetValueOrDefault("X-Mock","false")) == "true")'>
        <return-response>
          <set-status code="200" reason="OK" />
          <set-header name="Content-Type" exists-action="override">
            <value>application/json; charset=utf-8</value>
          </set-header>
          <set-body>@{
              var body = new { ok = true, source = "apim-mock" };
              return Newtonsoft.Json.JsonConvert.SerializeObject(body);
          }</set-body>
        </return-response>
      </when>

      <!-- REAL backend path -->
      <otherwise>
        <set-backend-service backend-id="apiscevs-backend" />
      </otherwise>
    </choose>
  </inbound>

  <backend><base /></backend>
  <outbound><base /></outbound>
  <on-error><base /></on-error>
</policies>


